<!DOCTYPE html>
<html>
<title>Webex Teams Meetings Quick Start</title>
<head>
    <script crossorigin src="https://unpkg.com/webex@^1/umd/webex.min.js"></script>
</head>
<body>
    <form id="credentials">
        <fieldset>
          <legend>Credentials</legend>
          <input id="access-token" name="accessToken" placeholder="Access Token" value="" type="text" />
          <button id="access-token-save" type="button" onclick="initWebex()">Webex.init()</button>
          <label id="access-token-status"></label>
        </fieldset>
      </form>
  <script>
        const tokenElm = document.querySelector('#access-token');
        const saveElm = document.querySelector('#access-token-save');
        const authStatusElm = document.querySelector('#access-token-status');
        const registerElm = document.querySelector('#registration-register');
        const unregisterElm = document.querySelector('#registration-unregister');
        const registrationStatusElm = document.querySelector('#registration-status');
      function initWebex() {
          console.log('Authentication#initWebex()');

          tokenElm.disabled = true;
          saveElm.disabled = true;
          authStatusElm.innerHTML = 'initializing...';

          webex = window.webex = Webex.init({
            config: {
              logger: {
                level: 'debug'
              },
              // Any other sdk config we need
            },
            credentials: {
              access_token: tokenElm.value
            }
          });

          webex.once('ready', () => {
            console.log('Authentication#initWebex() :: Webex Ready');
            registerElm.disabled = false;
            authStatusElm.innerHTML = 'Saved';
          });
    }
      
  let redirect_uri = `${window.location.protocol}//${window.location.host}`;

if (window.location.pathname) {
  redirect_uri += window.location.pathname;
}

// Inititate the SDK
// IN A PRODUCTION APP YOU SHOULD NOT HARDCODE THESE VALUES BUT INSTEAD LOAD
// THEM FROM THE ENVIRONMENT AT BUILD TIME. SECRETS AND OTHER CREDENTIALS SHOULD
// NOT BE COMMITTED TO THE CODEBASE.
// eslint-disable-next-line no-multi-assign
const webex = window.webex = Webex.init({
  config: {
    credentials: {
      client_id: 'Cb257d2a93b52b6752da37c61963292c766264023b6f42f391d887a100ad9bb4b',
      response_type: 'token',  
      redirect_uri,
      scope: 'meeting:recordings_read spark:kms meeting:admin_schedule_write meeting:schedules_read meeting:admin_recordings_write meeting:preferences_write meeting:recordings_write meeting:preferences_read meeting:admin_recordings_read meeting:admin_schedule_read meeting:schedules_write'
    }
  }
});

webex.once('ready', () => {
  // Now, let's set up the event listener for the Authenticate Button
  document.getElementById('authorization').addEventListener('submit', (event) => {
    // let's make sure we don't reload the page when we submit the form
    event.preventDefault();
    // initiate the login sequence if not authenticated.
    webex.authorization.initiateLogin();
  });

  // Now, let's set up the event listener for the Authenticate Button
  document.getElementById('logout').addEventListener('submit', (event) => {
    // let's make sure we don't reload the page when we submit the form
    event.preventDefault();

    if (webex.canAuthorize) {
      // if already authenticated, logout on click
      webex.logout();
    }
    else {
      // No user is authenticated
      console.log('cannot logout when no user is authenticated');
    }
  });

  if (webex.canAuthorize) {
    // Authorization is successful

    // your app logic goes here

    // Change Authentication status to `Authenticated`
    const authStatus = document.getElementById('authentication-status');

    authStatus.innerHTML = 'Authenticated';
    authStatus.style = 'color: green';
  }
});
  </script>
</body>
</html>
