<!DOCTYPE html>
<html>
<title>Webex Teams Meetings Quick Start</title>
<head>
    <script crossorigin src="https://unpkg.com/webex@^1/umd/webex.min.js"></script>
</head>
<body>
    <form id="authorization">
      <input id="authenticate-button" title="authenticate" type="submit" value="authenticate">
      <label for="authenticate"> &lt-- click here to authenticate</label>
    </form>

    <form id="logout">
      <input id="logout-button" title="logout" type="submit" value="logout">
      <label for="logout"> &lt-- click here to logout</label>
    </form>

    <div style="width: 30vw; display: flex; flex-direction: row; justify-content: space-between">
      <h3>Authentication Status: </h3>
      <h3 style="color:red" id="authentication-status">Not Authenticated</h3>
    </div>
  <script>
 
  let redirect_uri = `${window.location.protocol}//${window.location.host}`;
 if(window.location.hash.indexOf('access_token') !== -1) {
      console.log(window.location.hash.split('access_token=')[1].split('&')[0])
 }     

if (window.location.pathname) {
  redirect_uri += window.location.pathname;
}

// Inititate the SDK
// IN A PRODUCTION APP YOU SHOULD NOT HARDCODE THESE VALUES BUT INSTEAD LOAD
// THEM FROM THE ENVIRONMENT AT BUILD TIME. SECRETS AND OTHER CREDENTIALS SHOULD
// NOT BE COMMITTED TO THE CODEBASE.
// eslint-disable-next-line no-multi-assign
const webex = window.webex = Webex.init({
  config: {
    credentials: {
      client_id: 'Cb257d2a93b52b6752da37c61963292c766264023b6f42f391d887a100ad9bb4b',
      redirect_uri,
      scope: 'meeting:recordings_read spark:all meeting:admin_schedule_write meeting:schedules_read meeting:admin_recordings_write meeting:preferences_write meeting:recordings_write meeting:preferences_read meeting:admin_recordings_read meeting:admin_schedule_read meeting:schedules_write'
    }
  }
});

webex.once('ready', () => {
  // Now, let's set up the event listener for the Authenticate Button
  document.getElementById('authorization').addEventListener('submit', (event) => {
    // let's make sure we don't reload the page when we submit the form
    event.preventDefault();
    // initiate the login sequence if not authenticated.
    webex.authorization.initiateLogin();
  });

  // Now, let's set up the event listener for the Authenticate Button
  document.getElementById('logout').addEventListener('submit', (event) => {
    // let's make sure we don't reload the page when we submit the form
    event.preventDefault();

    if (webex.canAuthorize) {
      // if already authenticated, logout on click
      webex.logout();
    }
    else {
      // No user is authenticated
      console.log('cannot logout when no user is authenticated');
    }
  });

  if (webex.canAuthorize) {
    // Authorization is successful

    // your app logic goes here

    // Change Authentication status to `Authenticated`
    const authStatus = document.getElementById('authentication-status');

    authStatus.innerHTML = 'Authenticated';
    authStatus.style = 'color: green';
      
     }
});
  </script>
</body>
</html>
